<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
	<title>To-Do List</title>
  <style>
* { 
    font-family: "Itim"; 
  }
.container {
    display: grid;
    grid-template-rows: 8vw 20vw 2vw;
}
.header {
    grid-row: 1/2;
    display: grid;
    grid-template-columns: 2fr 4fr 2fr;
    grid-template-rows: 5vw 2.5vw;
    background-color: red;
    margin: 0px;
    padding: 0px;
}
footer {
    grid-row: 3/4;
    text-align: right;
    background-color: red;
    margin: 0px;
    padding: 0px;
}
.title {
    /* text-align: center; */
    justify-self: center;
    grid-column: 1/4;
    grid-row: 1/2;
    padding: 0px;
    margin: 0px; 
    font-size: 3.5vw; 
    padding-top: 2vw;
}
.linkbox {
    grid-row: 2/3;
    grid-column: 3/4;
    display: flex;
    flex-direction: row;
    justify-content: space-around;
}
button {
  border-radius: 30px;
}
.noButton {
  background-color: transparent;
  border: none;
  font-family:"Material Symbols Outlined";
}
.active {
    background-color: #f8cb02;
    color: black;
}
.main {
    grid-row: 2/3;
    display: grid; 
    grid-template-columns: 2fr 4fr 2fr;
}
.content {
    grid-column: 2/3;
}
.col1 {
    grid-column: 1/2;
    background-color: black;
}
.col2 {
    grid-column: 3/4;
    background-color: black;
}
.complete {
  text-decoration: line-through;
}
.urgent {
  color: red;
  font-style: bold;
}
.project {
  list-style-type: none;
  font-size: larger;
  margin: 2vw;
  font-style: italic;
}
.projectTasks {
  list-style-type: disc;
  font-size: smaller;
  margin-top: 0px;
  font-style: normal;
}
.tasks {
  list-style-type: none;
  display: flex;
  align-items: flex-start;
  flex-direction: column;
  gap: 20px;
  margin: 2vw;
}
.imageFit {
    object-fit: cover;
    width: 100%;
    max-height: 100%;
}
  </style>
</head>

<body onload="displayTasks()">
<div id="container" class="container">
  <div class="header">
    <div class="title">Get 'er Done !</div>
    <div id="linkbox" class="linkbox">
    </div>
  </div>
  <div class="main">
    <div class="col1"></div>
    <div id="content" class="content"></div>
    <div class="col2"></div>
  </div>
  <footer id="footer"></footer>
</div>
</body>
<script>

// get task array from local storage
let taskList = JSON.parse(localStorage.getItem('taskList')) || [];
// get project array from local storage
let projectList = JSON.parse(localStorage.getItem('projectList')) || [];



// Make the footer
const footer = document.getElementById('footer');
footer.innerHTML = `Copyright Â© ${new Date().getFullYear()} SLM`;

// Make the buttons for the header
const allTasksButton = document.createElement('button')
allTasksButton.setAttribute('id', 'allTasks')
allTasksButton.textContent = 'All Tasks'
allTasksButton.addEventListener('click', (e) => {
  e.target.classList.add('active')
  const btn1 = document.getElementById('newTask')
  btn1.classList.remove('active')
  const btn2 = document.getElementById('dueToday')
  btn2.classList.remove('active')
  const btn3 = document.getElementById('projects')
  btn3.classList.remove('active')
  let content = document.getElementById('content')
  content.innerHTML = "";
  displayTasks()
})

const newTaskButton = document.createElement('button')
newTaskButton.setAttribute('id', 'newTask')
newTaskButton.textContent = 'New Task'
newTaskButton.addEventListener('click', (e) => {
  e.target.classList.add('active')
  const btn1 = document.getElementById('allTasks')
  btn1.classList.remove('active')
  const btn2 = document.getElementById('dueToday')
  btn2.classList.remove('active')
  const btn3 = document.getElementById('projects')
  btn3.classList.remove('active')
  let content = document.getElementById('content')
  content.innerHTML = "";
  makeNewTaskForm();
})

const dueTodayButton = document.createElement('button')
dueTodayButton.setAttribute('id', 'dueToday')
dueTodayButton.textContent = 'Due Today'
dueTodayButton.addEventListener('click', (e) => {
  e.target.classList.add('active')
  const btn1 = document.getElementById('allTasks')
  btn1.classList.remove('active')
  const btn2 = document.getElementById('newTask')
  btn2.classList.remove('active')
  const btn3 = document.getElementById('projects')
  btn3.classList.remove('active')
  let content = document.getElementById('content')
  content.innerHTML = "";
  displayTodayTasks();
})

const projectsButton = document.createElement('button')
projectsButton.setAttribute('id', 'projects')
projectsButton.textContent = 'Projects'
projectsButton.addEventListener('click', (e) => {
  e.target.classList.add('active')
  const btn1 = document.getElementById('allTasks')
  btn1.classList.remove('active')
  const btn2 = document.getElementById('newTask')
  btn2.classList.remove('active')
  const btn3 = document.getElementById('dueToday')
  btn3.classList.remove('active')
  let content = document.getElementById('content')
  content.innerHTML = "";
  displayProjects();
})

let link = document.getElementById('linkbox')
link.appendChild(allTasksButton);
link.appendChild(newTaskButton);
link.appendChild(dueTodayButton);
link.appendChild(projectsButton);


// display a list of tasks, each with a delete and edit button
function displayTasks() {
  allTasksButton.classList.add('active');
  let content=document.getElementById('content');
  content.innerHTML="";
  const taskListElement = document.createElement('div');
  // put in date order
  taskList = taskList.sort(function (a, b) {
      var dateA = new Date(a.deadline).getTime();
      var dateB = new Date(b.deadline).getTime();
      return dateA < dateB ? -1 : 1;
    });
  taskList.forEach((task, index) => {
      const li = document.createElement("li");
      const deleteButton = document.createElement("button");
      deleteButton.classList.add('noButton');
      deleteButton.innerHTML = "Delete";
      deleteButton.onclick = function () {
        taskList.splice(index, 1);
        saveTasks();
        displayTasks();
      };
      const editButton = document.createElement("button");
      editButton.classList.add('noButton')
      editButton.innerHTML = "Edit";
      editButton.onclick = function () {
        editTask(index);
      };
      li.innerHTML = `${task.deadline} ${task.taskName}  :  ${task.details} <i>${task.project}</i>`;
      if (task.complete === 'complete') {
        li.classList.add('complete');
      };
      if (task.urgent === 'urgent') {
        li.classList.add('urgent');
      };
      li.appendChild(deleteButton);
      li.appendChild(editButton);
      taskListElement.appendChild(li);
      taskListElement.classList.add('tasks');
  });
  content.appendChild(taskListElement);
}

// make the form to add a task
function makeNewTaskForm () {
  document.getElementById("content").innerHTML = "";
  let form = document.createElement("form");

  let taskNameInput = document.createElement("input");
  taskNameInput.setAttribute("type", "text");
  taskNameInput.setAttribute("id", "taskName");
  taskNameInput.setAttribute("placeholder", "Task Name");
  form.appendChild(taskNameInput);

  let deadlineInput = document.createElement("input");
  deadlineInput.setAttribute("type", "date");
  deadlineInput.setAttribute("id", "deadline");
  deadlineInput.setAttribute("placeholder", "Deadline");
  form.appendChild(deadlineInput);

  let detailsInput = document.createElement("input");
  detailsInput.setAttribute("type", "textarea");
  detailsInput.setAttribute("id", "details");
  detailsInput.setAttribute("placeholder", "Details");
  detailsInput.setAttribute('style', 'cols:30; rows:3;');
  form.appendChild(detailsInput);

  let completeInput = document.createElement('select');
  completeInput.setAttribute('id', 'complete');
  let opt = ["not complete","complete"];
  let options="";
  opt.map((op,i)=>{
    options+=`<option value="${op}" id="${i}" style="border-radius: 5px;"">${op}</option>`
  });
  completeInput.innerHTML=options;
  form.appendChild(completeInput);

  let urgentInput = document.createElement('select');
  urgentInput.setAttribute('id', 'urgent');
  let opt2 = ["normal","urgent"];
  let options2="";
  opt2.map((op,i)=>{
    options2+=`<option value="${op}" id="${i}" style="border-radius: 5px;"">${op}</option>`
  });
  urgentInput.innerHTML=options2;
  form.appendChild(urgentInput);

  let projectInput = document.createElement('select');
  projectInput.setAttribute('id', 'project');
  projectInput.innerHTML = "";
  projectList.forEach((project) => {
    let option = document.createElement("option");
    option.value = project.projectName;
    option.textContent = project.projectName;
    projectInput.appendChild(option);
    });
  form.appendChild(projectInput);

  let addTaskButton = document.createElement('button')
  addTaskButton.setAttribute('id', 'addTask')
  addTaskButton.textContent = 'Add Task'
  addTaskButton.addEventListener('click', (e) => {
    addTask() 
  })
  form.appendChild(addTaskButton);

  document.getElementById("content").appendChild(form);
  makeNewProjectForm();
}
// make the form to add a project
function makeNewProjectForm () {
  let form2 = document.createElement("form2");

  let projectNameInput = document.createElement("input");
  projectNameInput.setAttribute("type", "text");
  projectNameInput.setAttribute("id", "projectName");
  projectNameInput.setAttribute("placeholder", "Project Name");
  form2.appendChild(projectNameInput);
  
  let addProjectButton = document.createElement('button')
  addProjectButton.setAttribute('id', 'addProject')
  addProjectButton.textContent = 'Add Project'
  addProjectButton.addEventListener('click', (e) => {
    addProject() 
  })
  form2.appendChild(addProjectButton);

  document.getElementById("content").appendChild(form2);
}

// get input from page, make a new task, put it in task array
function addTask() { 
  const taskName = document.getElementById("taskName").value;
  const deadline = document.getElementById("deadline").value;
  const details = document.getElementById("details").value;
  const complete = document.getElementById("complete").value;
  const urgent = document.getElementById("urgent").value;
  const project = document.getElementById("project").value;
  const newTask = new Task(taskName, deadline, details, complete, urgent, project);
  taskList.push(newTask);
  saveTasks();
}

// get input from page, make a new project, put it in project array
function addProject() {
  const projectName = document.getElementById("projectName").value;
  const newProject = new Project(projectName);
  projectList.push(newProject);
  saveProjects();
  makeNewTaskForm();
}

// display a list of projects, each with a delete button and a list of tasks
function displayProjects() {
  let content=document.getElementById('content');
  content.innerHTML="";
  const projectListElement = document.createElement('div');

  projectList.forEach((project, index) => {
    const projectLi = document.createElement("li");
    const deleteButton = document.createElement("button");
    deleteButton.innerHTML = "Delete";
    deleteButton.onclick = function () {
      projectList.splice(index, 1);
      saveProjects();
      removeDeletedProject(project.projectName);
      displayProjects();
    };

    // Find tasks for the current project
    const tasksForProject = taskList.filter((task) => task.project === project.projectName);
    const taskListElement = document.createElement("ul");
    // Add each task to the project's task list
    tasksForProject.forEach((task) => {
      const taskLi = document.createElement("li");
      taskLi.innerHTML = `${task.deadline} ${task.taskName}   :  ${task.details}`;
      if (task.complete === 'complete') {
        taskLi.classList.add('complete');
      };
      if (task.urgent === 'urgent') {
        taskLi.classList.add('urgent');
      };
      taskListElement.appendChild(taskLi);
    });
    // append the name, the delete button, and the task list
    // of each project to the project list
    projectLi.innerHTML = `${project.projectName}`;
    projectLi.appendChild(deleteButton);
    taskListElement.classList.add('projectTasks')
    projectLi.appendChild(taskListElement);
    projectListElement.appendChild(projectLi);
    projectListElement.classList.add('project');
  });
  content.appendChild(projectListElement);
}

function editTask(index) {
  const task = taskList[index];
  const newTaskName = prompt("Enter new task name:", task.taskName);
  const newDeadline = prompt("Enter new deadline:", task.deadline);
  const newDetails = prompt("Enter new details:", task.details);
  const newComplete = prompt("Is the task complete, yes or no?", task.complete);
  const newUrgent = prompt("Is the task urgent or normal?", task.urgent);
  const newProject = prompt("Enter project:", task.project);
  task.taskName = newTaskName;
  task.deadline = newDeadline;
  task.details = newDetails;
  task.complete = newComplete;
  task.urgent = newUrgent;
  task.project = newProject;
  saveTasks();
  displayTasks();
}


// Find tasks for the current day
function todayTasks() {
    let currentDate = new Date().toLocaleDateString("fr-CA", {year:"numeric", month: "2-digit", day:"2-digit"})
    const tasksForToday = taskList.filter((task) => task.deadline === currentDate);
    return tasksForToday;
}

// 
function displayTodayTasks() {
  let content=document.getElementById('content');
  content.innerHTML="";
  const taskListElement = document.createElement('div');
  let tasksForToday = todayTasks();
  tasksForToday.forEach((task) => {
    const li = document.createElement("li");
    li.innerHTML = `${task.taskName}   :  ${task.details} <i>${task.project}</i>`;
    if (task.complete === 'complete') {
      li.classList.add('complete');
    };
    if (task.urgent === 'urgent') {
      li.classList.add('urgent');
    };
    taskListElement.appendChild(li);
    taskListElement.classList.add('tasks');
  });
  content.appendChild(taskListElement);
}



// save task array to local storage
function saveTasks() {
  localStorage.setItem('taskList', JSON.stringify(taskList));
}

// task constructor
function Task(taskName, deadline, details, complete, urgent, project) {
    this.taskName = taskName;
    this.deadline = deadline;
    this.details = details;
    this.complete = complete;
    this.urgent = urgent;
    this.project = project;
}

// save project array to local storage
function saveProjects() {
  localStorage.setItem('projectList', JSON.stringify(projectList));
}

// project constructor
function Project(projectName) {
    this.projectName = projectName;
}

function removeDeletedProject(project) {
  const tasksInProject = taskList.filter((task) => task.project === project);
  tasksInProject.forEach((task) => {
    task.project = "";
    saveTasks();
  });
}
</script>
</html>