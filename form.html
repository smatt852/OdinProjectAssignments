<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Abel&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,500;1,200&display=swap"
      rel="stylesheet"
    />
    <title>Form Validation</title>
    <style>
      * {
        font-family: "Source Code Pro";
        font-weight: 500;
        font-size: 4vh;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #029c0a;
      }
      .invalid {
        background-color: rgb(250, 3, 3);
        color: white;
      }
      .error-message {
        color: red;
        font-family: "Abel";
        font-size: 2.5vh;
      }
      form {
        display: grid;
        grid-template-rows: repeat(6 minmax(1vh 0.6fr));
        padding: 9vh;
        width: 70vh;
        height: 80vh;
        background-color: #fff;
        border-radius: 20px;
        box-shadow: 20px 20px 20px #016606;
      }
      input,
      select,
      input:valid,
      input:focus {
        width: 95%;
        border: none;
        border-bottom: 1px solid #ccc;
        outline: none;
        background-color: transparent;
        color: black;
      }
      input[type="submit"] {
        opacity: 0;
      }
      input[type="submit"]:enabled {
        opacity: 1;
        background-color: green;
        border: none;
        border-radius: 5px;
        color: #fff;
        font-weight: bold;
        align-items: center;
        justify-content: center;
      }
      select {
        color: rgb(105, 104, 104);
      }
    </style>
  </head>
  <body>
    <form id="myForm">
      <input
        type="email"
        id="email"
        placeholder="email"
        autocomplete="off"
        required
      />
      <span class="error-message" id="emailError"></span>
      <!-- the span tag just pops an error message below the input -->

      <br /><br />
      <select id="Country" placeholder="Country" required>
        <option value="" disabled selected>Please select your country</option>
        <option value="Can">Canada</option>
        <option value="US">United States</option>
      </select>
      <br /><br />

      <input
        type="text"
        id="zipCode"
        placeholder="Zip Code"
        autocomplete="off"
        required
      />
      <span class="error-message" id="zipCodeError"></span>
      <br /><br />
      <input
        type="password"
        id="password"
        placeholder="Password"
        autocomplete="off"
        required
        minlength="6"
        pattern="(?=.*[A-Z])(?=.*\d).+"
      />
      <span class="error-message" id="passwordError"></span>
      <br /><br />
      <input
        type="password"
        id="passwordConfirmation"
        placeholder="Confirm Password"
        autocomplete="off"
        required
      />
      <span class="error-message" id="passwordConfirmationError"></span>
      <br /><br />
      <input type="submit" value="Submit" disabled="true" id="submitButton" />
      <!-- the submit button stays disabled until the form is valid -->
    </form>

    <script>
      // gather inputs
      const form = document.getElementById("myForm");
      const emailInput = document.getElementById("email");
      const countryInput = document.getElementById("Country");
      const zipCodeInput = document.getElementById("zipCode");
      const passwordInput = document.getElementById("password");
      const passwordConfirmationInput = document.getElementById(
        "passwordConfirmation"
      );
      const submitButton = document.getElementById("submitButton");

      // listeners validate on blur
      emailInput.addEventListener("blur", function () {
        validateEmail();
      });
      zipCodeInput.addEventListener("blur", function () {
        validateZipCode();
      });
      passwordInput.addEventListener("blur", function () {
        validatePassword();
      });
      passwordConfirmationInput.addEventListener("blur", function () {
        validatePasswordConfirmation();
      });

      // functions to validate input and change css and show error message
      // if invalid
      function validateEmail() {
        if (emailInput.validity.valid) {
          // validity.valid is from the Constraint Validation API,
          // it checks validity against the pattern given
          // and if the input is filled in
          emailInput.classList.remove("invalid");
          emailError.textContent = "";
        } else {
          emailInput.classList.add("invalid");
          emailError.textContent = "Please enter a valid email address.";
          //   this error msg appears in the span tag beneath the input
        }
      }

      // For each country, defines the pattern that the ZIP has to follow
      function validateZipCode() {
        const country = document.getElementById("Country").value;
        let rule = "";
        let errorMsg = "";
        // For each country, defines the pattern that the ZIP has to follow
        if (countryInput.value === "Can") {
          rule = "^[A-Za-z]\\d[A-Za-z][ -]?\\d[A-Za-z]\\d$";
          errorMsg = "Follow the format Z9Z 9Z9";
        } else {
          rule = "^\\d{5}$";
          errorMsg = "US ZIPs must have 5 digits";
        }

        // Build the constraint checker
        constraint = new RegExp(rule, "");
        if (constraint.test(zipCodeInput.value)) {
          zipCodeInput.classList.remove("invalid");
          zipCodeError.textContent = "";
        } else {
          zipCodeInput.classList.add("invalid");
          zipCodeError.textContent = errorMsg;
        }
      }

      function validatePassword() {
        if (passwordInput.validity.valid) {
          passwordInput.classList.remove("invalid");
          passwordError.textContent = "";
        } else {
          passwordInput.classList.add("invalid");
          passwordError.textContent =
            "Please enter a password with at least 6 characters, one capital letter, and one number.";
        }
      }

      function validatePasswordConfirmation() {
        if (passwordConfirmationInput.value === passwordInput.value) {
          passwordConfirmationInput.classList.remove("invalid");
          passwordConfirmationError.textContent = "";
        } else {
          passwordConfirmationInput.classList.add("invalid");
          passwordConfirmationError.textContent =
            "Please enter the same password as above.";
        }
      }

      function showAllErrors() {
        validateEmail();
        validateZipCode();
        validatePassword();
        validatePasswordConfirmation();
      }

      form.addEventListener("input", function (event) {
        // using a listener on input checks validity before the form is submitted
        if (
          form.checkValidity() === true &&
          passwordConfirmationInput.value === passwordInput.value
        ) {
          submitButton.disabled = false;
        }
      });

      form.addEventListener("submit", function (event) {
        if (
          form.checkValidity() === true &&
          passwordConfirmationInput.value === passwordInput.value
        ) {
          event.preventDefault();
          alert("High five! The form is submitted.");

          // reset the form
          emailInput.value = null;
          countryInput.value = "";
          zipCodeInput.value = null;
          passwordInput.value = null;
          passwordConfirmationInput.value = null;
          submitButton.disabled = true;
        }
      });
    </script>
  </body>
</html>
